<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coin Flip</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="header" style="text-align: center">            
            <h1>Coin Flip</h1>
        </div>
        <div class="container theme-showcase" role="main">
            <div class="row">
                <div class="col-md-12" style="width: 80%; margin: 20px; margin-left: 100px;">
                    <input id="private_key" type="text" class="form-control" placeholder="private key">
                </div>
                <div class="col-md-12" style="width: 50%; margin: 20px; margin-left: 100px;">
                    <input id="wallet_address" type="text" class="form-control" placeholder="wallet address">
                </div>
                <div class="col-md-12">
                    <button id="request-score" type="button" class="btn btn-default" style="margin-left: 410px;">
                        SEND TX
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/icon-project/icon-sdk-js@latest/build/icon-sdk-js.web.min.js"></script>
    <script>
        var IconService = window['icon-sdk-js']

        const { HttpProvider, IconBuilder, IconWallet, IconAmount, IconConverter } = IconService
        const provider = new HttpProvider('https://ctz.solidwallet.io/api/v3')
        const iconService = new IconService(provider)


        var requestAddress = document.getElementById("request-address")
        var responseAddress = document.getElementById("response-address")
        var requestTransaction = document.getElementById("request-transaction")
        var requestScore = document.getElementById("request-score")
        var balanceRemain = document.getElementById("balance-remain")
        var ppk = document.getElementById("private_key")
        var address = document.getElementById("wallet_address")

        var coin = -1
        var balance = undefined
        var fromAddress = ''
        var result = ''
        var betresult = undefined

        requestScore.onclick = async function () {
            console.log('before builder ')
            console.log(ppk.value)
            console.log(address.value)

            var wallet = IconWallet.loadPrivateKey(ppk.value);


            for (var i = 0; i < 200; i++) {
                var txObj = new IconBuilder.IcxTransactionBuilder()
                var txObjData = txObj.from(address.value)
                .to("cx142be5eff783a9243ca49fb8c46f7613e3d486e9")
                .value(IconAmount.of(0.001, IconAmount.Unit.ICX).toLoop())
                .stepLimit(IconConverter.toBigNumber(1000000))
                .nid(IconConverter.toBigNumber(1))
                .nonce(IconConverter.toBigNumber(1))
                .version(IconConverter.toBigNumber(3))
                .timestamp((new Date()).getTime() * 1000)
                .build()
                console.log("for loop : "+ i)
                var signedTransaction = new IconService.SignedTransaction(txObjData, wallet)
                var txHash = await iconService.sendTransaction(signedTransaction).execute();
                console.log(txHash)
            }
        }


    </script>
</body>

</html>

